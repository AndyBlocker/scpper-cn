/* import color scheme variables */
@import './scheme.css';

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    color-scheme: light;
  }
  
  html {
    background-color: rgb(var(--bg));
    color: rgb(var(--fg));
  }
  
  /* 全局字体与等宽数字 */
  body {
    background-color: transparent;
    color: inherit;
    font-family: system-ui, -apple-system, "SF Pro Text", "PingFang SC",
                 "Hiragino Sans GB", "Segoe UI", Roboto, "Noto Sans CJK SC",
                 "Microsoft YaHei UI", Arial, sans-serif;
    -webkit-font-smoothing: antialiased;
    font-feature-settings: "tnum" 1;
    font-variant-numeric: tabular-nums;
  }
  
  /* 深色模式 */
  html.dark {
    color-scheme: dark;
  }
  
  /* 浅色模式显式声明 */
  html.light {
    color-scheme: light;
  }
}

@layer components {
  /* Skip to content link: visible on focus for a11y */
  .skip-link {
    position: absolute;
    top: 0.25rem;
    left: 0.25rem;
    z-index: 1000;
    padding: 0.5rem 0.75rem;
    border-radius: 0.5rem;
    background: rgb(var(--panel));
    color: rgb(var(--fg));
    border: 1px solid rgb(var(--panel-border));
    box-shadow: 0 10px 24px rgba(15,23,42,0.12);
    transform: translateY(-200%);
  }
  .skip-link:focus {
    transform: translateY(0);
    outline: 2px solid rgb(var(--accent));
    outline-offset: 2px;
  }

  /* Safe-area padding helpers (for notched devices) */
  .safe-pt { padding-top: env(safe-area-inset-top); }
  .safe-pb { padding-bottom: env(safe-area-inset-bottom); }
  .safe-pl { padding-left: env(safe-area-inset-left); }
  .safe-pr { padding-right: env(safe-area-inset-right); }
  .safe-px { padding-left: env(safe-area-inset-left); padding-right: env(safe-area-inset-right); }
  .safe-py { padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom); }

  /* 滚动条样式 */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  
  ::-webkit-scrollbar-track {
    @apply bg-transparent;
  }
  
  ::-webkit-scrollbar-thumb {
    @apply bg-neutral-700 dark:bg-neutral-600 rounded;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    @apply bg-neutral-600 dark:bg-neutral-500;
  }
  
  /* 消除输入框默认样式 */
  input[type="search"]::-webkit-search-decoration,
  input[type="search"]::-webkit-search-cancel-button,
  input[type="search"]::-webkit-search-results-button,
  input[type="search"]::-webkit-search-results-decoration {
    -webkit-appearance: none;
  }
  
  /* 选中文本样式 */
  ::selection,
  ::-moz-selection {
    background-color: rgba(var(--accent), 0.55);
    color: #0b1120; /* ensure strong contrast on highlight */
  }

  html.dark ::selection,
  html.dark ::-moz-selection {
    background-color: rgba(var(--accent-weak), 0.65);
    color: #0b1120;
  }
  
  /* 过渡动画（仅常见交互元素，避免全局性能压力） */
  a, button, input, select, textarea {
    @apply transition-colors duration-200;
  }
  @media (prefers-reduced-motion: reduce) {
    a, button, input, select, textarea, .transition-colors { transition: none !important; }
  }
  
  /* 禁用图片拖拽 */
  img {
    -webkit-user-drag: none;
    user-select: none;
  }

  /* Snippet keyword highlight (PGroonga snippet_html -> <span class="keyword">) */
  html.light .keyword {
    @apply rounded px-0.5;
    background-color: #fde68a !important; /* amber-200 */
    color: #111827 !important;           /* neutral-900 */
  }
  html.dark .keyword {
    background-color: rgba(234, 179, 8, 0.35) !important; /* amber-400 @ ~35% */
    color: #f5f5f5 !important;                             /* neutral-100 */
  }

  /* 分段控件（Segmented Control） */
  .segmented {
    @apply inline-flex flex-nowrap gap-1 p-1 border border-neutral-200 dark:border-neutral-800 rounded-full bg-white/80 dark:bg-neutral-900/60 backdrop-blur overflow-x-auto;
  }
  .segmented > button {
    @apply px-3 py-1 text-xs sm:text-sm font-semibold rounded-full text-neutral-600 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800 focus:outline-none focus:ring-2 focus:ring-[rgb(var(--accent))] transition whitespace-nowrap;
  }
  .segmented > button[aria-pressed="true"] {
    @apply bg-white dark:bg-neutral-900 text-neutral-900 dark:text-neutral-100 shadow;
  }
}

/* CodeMirror overrides for FTML editor */
.CodeMirror {
  height: 100% !important;
  font-family: 'JetBrains Mono', 'Fira Code', ui-monospace, monospace !important;
  font-size: 13px !important;
  line-height: 1.5 !important;
}

.CodeMirror-gutters {
  width: 50px !important;
  min-width: 50px !important;
  max-width: 50px !important;
  background: rgb(250 250 250) !important;
  border-right: 1px solid rgb(229 229 229) !important;
}

.CodeMirror-gutter.CodeMirror-linenumbers {
  width: 42px !important;
  min-width: 42px !important;
  max-width: 42px !important;
}

.CodeMirror-linenumber {
  width: 42px !important;
  padding: 0 8px !important;
  text-align: right !important;
  color: rgb(163 163 163) !important;
}

.CodeMirror-sizer {
  margin-left: 50px !important;
}

.CodeMirror-gutter-wrapper {
  left: -50px !important;
}

.CodeMirror-scroll {
  overflow: auto !important;
}

.CodeMirror-cursor {
  border-left: 2px solid rgb(14 165 233) !important;
}

.CodeMirror-selected {
  background: rgba(56, 189, 248, 0.15) !important;
}

.CodeMirror-focused .CodeMirror-selected {
  background: rgba(56, 189, 248, 0.25) !important;
}

html.dark .CodeMirror {
  background: rgb(23 23 23) !important;
  color: rgb(245 245 245) !important;
}

html.dark .CodeMirror-gutters {
  background: rgba(38, 38, 38, 0.5) !important;
  border-color: rgb(64 64 64) !important;
}

html.dark .CodeMirror-linenumber {
  color: rgb(115 115 115) !important;
}

/* Active line highlighting */
.CodeMirror-activeline-background {
  background: rgba(0, 0, 0, 0.03) !important;
}

html.dark .CodeMirror-activeline-background {
  background: rgba(255, 255, 255, 0.03) !important;
}

/* Bracket matching */
.CodeMirror-matchingbracket {
  background: rgba(56, 189, 248, 0.3) !important;
  color: inherit !important;
  font-weight: bold !important;
  border-bottom: 2px solid rgb(14 165 233) !important;
}

.CodeMirror-nonmatchingbracket {
  background: rgba(239, 68, 68, 0.3) !important;
  color: rgb(239 68 68) !important;
}

/* FTML syntax highlighting */
.cm-ftml-block {
  color: rgb(147 51 234) !important; /* purple-600 */
  font-weight: 500;
}

.cm-ftml-link {
  color: rgb(14 165 233) !important; /* sky-500 */
  text-decoration: underline;
}

.cm-ftml-code {
  background: rgba(0, 0, 0, 0.05);
  padding: 1px 3px;
  border-radius: 3px;
  font-family: 'JetBrains Mono', monospace;
  color: rgb(220 38 38) !important; /* red-600 */
}

.cm-ftml-strike {
  text-decoration: line-through;
  color: rgb(115 115 115) !important;
}

.cm-ftml-underline {
  text-decoration: underline;
}

.cm-ftml-mono {
  font-family: 'JetBrains Mono', monospace;
  background: rgba(0, 0, 0, 0.05);
  padding: 1px 3px;
  border-radius: 3px;
}

.cm-ftml-comment {
  color: rgb(115 115 115) !important;
  font-style: italic;
}

/* Dark mode FTML syntax */
html.dark .cm-ftml-block {
  color: rgb(192 132 252) !important; /* purple-400 */
}

html.dark .cm-ftml-link {
  color: rgb(56 189 248) !important; /* sky-400 */
}

html.dark .cm-ftml-code {
  background: rgba(255, 255, 255, 0.08);
  color: rgb(248 113 113) !important; /* red-400 */
}

html.dark .cm-ftml-strike {
  color: rgb(163 163 163) !important;
}

html.dark .cm-ftml-mono {
  background: rgba(255, 255, 255, 0.08);
}

html.dark .cm-ftml-comment {
  color: rgb(163 163 163) !important;
}

/* GFM inherited styles */
.cm-header {
  color: rgb(37 99 235) !important; /* blue-600 */
  font-weight: bold;
}

.cm-strong {
  font-weight: bold;
}

.cm-em {
  font-style: italic;
}

.cm-link {
  color: rgb(14 165 233) !important;
}

.cm-url {
  color: rgb(107 114 128) !important;
}

.cm-comment {
  color: rgb(107 114 128) !important;
  font-style: italic;
}

html.dark .cm-header {
  color: rgb(96 165 250) !important; /* blue-400 */
}

html.dark .cm-link {
  color: rgb(56 189 248) !important;
}

html.dark .cm-url {
  color: rgb(156 163 175) !important;
}

html.dark .cm-comment {
  color: rgb(156 163 175) !important;
}
