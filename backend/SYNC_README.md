# SCPPER-CN æ•°æ®åŒæ­¥ç³»ç»Ÿ

å®Œæ•´çš„SCP Foundationä¸­æ–‡ç«™æ•°æ®æ‹‰å–å’Œåˆ†æç³»ç»Ÿã€‚

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®ä»CROM GraphQL APIæ‹‰å–SCPä¸­æ–‡ç«™çš„å®Œæ•´æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š
- 30,849ä¸ªé¡µé¢çš„å®Œæ•´ä¿¡æ¯
- 87ä¸‡+æŠ•ç¥¨è®°å½•
- 37ä¸‡+ä¿®è®¢è®°å½•  
- é¡µé¢å…³ç³»ã€è´¡çŒ®è€…ä¿¡æ¯ç­‰
- æœ‰é™çš„ç”¨æˆ·æ•°æ®ï¼ˆAPIé™åˆ¶ä¸º5ä¸ªç”¨æˆ·ï¼‰

## ğŸ“ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/sync/
â”‚   â”œâ”€â”€ final-sync.js          # ğŸš€ æœ€ç»ˆç‰ˆæœ¬æ•°æ®åŒæ­¥è„šæœ¬
â”‚   â”œâ”€â”€ full-data-pull.js      # âœ… å®Œæ•´æ•°æ®æ‹‰å–ï¼ˆå¤‡ç”¨ï¼‰
â”‚   â”œâ”€â”€ sqlite-test.js         # ğŸ§ª SQLiteæµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ archive/               # ğŸ“¦ å†å²ç‰ˆæœ¬å­˜æ¡£
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma          # æ•°æ®åº“æ¨¡å‹å®šä¹‰
â”œâ”€â”€ docker-compose.yml         # DockeræœåŠ¡é…ç½®
â””â”€â”€ .env                       # ç¯å¢ƒå˜é‡é…ç½®
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘é…ç½®
vim .env
```

å…³é”®é…ç½®ï¼š
```env
CROM_API_URL="https://apiv1.crom.avn.sh/graphql"
TARGET_SITE_URL="http://scp-wiki-cn.wikidot.com"
```

### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

### 3. è¿è¡Œæ•°æ®åŒæ­¥

**æ¨èä½¿ç”¨æœ€ç»ˆç‰ˆæœ¬è„šæœ¬ï¼š**

```bash
node src/sync/final-sync.js
```

**æˆ–è€…ä½¿ç”¨å®Œæ•´ç‰ˆæœ¬ï¼ˆå¦‚æœéœ€è¦æ›´è¯¦ç»†çš„æ£€æŸ¥ç‚¹ï¼‰ï¼š**

```bash
node src/sync/full-data-pull.js
```

## ğŸ“Š è„šæœ¬åŠŸèƒ½å¯¹æ¯”

| è„šæœ¬ | åŠŸèƒ½ | æ–­ç‚¹ç»­ä¼  | é¢‘ç‡ä¼˜åŒ– | æ¨èåº¦ |
|------|------|----------|----------|---------|
| `final-sync.js` | å®Œæ•´åŒæ­¥+ä¼˜åŒ– | âœ… | âœ… | â­â­â­â­â­ |
| `full-data-pull.js` | å®Œæ•´åŒæ­¥+è¯¦ç»†æ—¥å¿— | âœ… | âŒ | â­â­â­â­ |
| `sqlite-test.js` | å¿«é€Ÿæµ‹è¯• | âŒ | âŒ | â­â­â­ |

## âš¡ æ€§èƒ½ç‰¹æ€§

### ğŸ¯ æœ€ç»ˆç‰ˆæœ¬ä¼˜åŒ–
- **æ™ºèƒ½é¢‘ç‡æ§åˆ¶**: 1.8è¯·æ±‚/ç§’ï¼Œæ¥è¿‘APIé™åˆ¶ä½†å®‰å…¨
- **æ‰¹æ¬¡ä¼˜åŒ–**: 10é¡µé¢/æ‰¹æ¬¡ï¼Œå……åˆ†åˆ©ç”¨æ¯æ¬¡è¯·æ±‚
- **æ–­ç‚¹ç»­ä¼ **: è‡ªåŠ¨æ£€æµ‹ä¸­æ–­ç‚¹ï¼Œæ— ç¼ç»§ç»­
- **å†…å­˜ä¼˜åŒ–**: åˆ†æ‰¹å¤„ç†ï¼Œé¿å…å†…å­˜æº¢å‡º
- **é”™è¯¯æ¢å¤**: è‡ªåŠ¨é‡è¯•å’Œé”™è¯¯å¤„ç†

### ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡
- **å¤„ç†é€Ÿåº¦**: ~5-8é¡µé¢/ç§’
- **å…¨é‡æ—¶é—´**: ~1.5-2å°æ—¶
- **Rate Limit**: 94,398ç‚¹ (31%é…é¢)
- **æ•°æ®å®Œæ•´æ€§**: 99.9%+

## ğŸ“Š æ•°æ®ç»“æ„

### é¡µé¢æ•°æ® (30,849æ¡)
```json
{
  "url": "http://scp-wiki-cn.wikidot.com/scp-173",
  "title": "SCP-173",
  "wikidotId": 123456,
  "rating": 1234,
  "voteCount": 567,
  "sourceLength": 5678,
  "createdByUser": "username",
  "tags": ["scp", "euclid", "sculpture"]
}
```

### æŠ•ç¥¨è®°å½• (876,838æ¡)
```json
{
  "pageUrl": "http://scp-wiki-cn.wikidot.com/scp-173",
  "userWikidotId": 123456,
  "userName": "username",
  "timestamp": "2023-01-01T00:00:00.000Z",
  "direction": 1
}
```

### ç”¨æˆ·æ•°æ® (5æ¡ - APIé™åˆ¶)
```json
{
  "name": "username",
  "displayName": "Display Name",
  "wikidotId": 123456,
  "rank": 100,
  "totalRating": 5000,
  "pageCount": 50
}
```

## ğŸ”§ APIé™åˆ¶è¯´æ˜

### CROM APIé™åˆ¶
- **Rate Limit**: 300,000ç‚¹/5åˆ†é’Ÿçª—å£
- **è¯·æ±‚é¢‘ç‡**: æœ€å¤š2è¯·æ±‚/ç§’
- **ç”¨æˆ·æŸ¥è¯¢**: æœ€å¤šè¿”å›5ä¸ªç”¨æˆ·ï¼ˆAPIè®¾è®¡é™åˆ¶ï¼‰
- **åˆ†é¡µ**: æ”¯æŒcursor-basedåˆ†é¡µ

### è§£å†³æ–¹æ¡ˆ
- âœ… **é¡µé¢æ•°æ®**: å®Œæ•´æ‹‰å–30,849é¡µé¢
- âœ… **æŠ•ç¥¨æ•°æ®**: é€šè¿‡é¡µé¢æŸ¥è¯¢è·å–å®Œæ•´æŠ•ç¥¨è®°å½•
- âœ… **ä¿®è®¢æ•°æ®**: å®Œæ•´çš„é¡µé¢ä¿®è®¢å†å²
- âŒ **ç”¨æˆ·æ•°æ®**: å—APIé™åˆ¶ï¼Œä»…5ä¸ªç”¨æˆ·æ ·æœ¬

## ğŸ—‚ï¸ è¾“å‡ºæ–‡ä»¶

åŒæ­¥å®Œæˆåç”Ÿæˆçš„æ–‡ä»¶ï¼š

```
final-sync-data/
â”œâ”€â”€ pages-data-[timestamp].json      # é¡µé¢æ•°æ®
â”œâ”€â”€ votes-data-[timestamp].json      # æŠ•ç¥¨è®°å½•
â”œâ”€â”€ revisions-data-[timestamp].json  # ä¿®è®¢è®°å½•
â”œâ”€â”€ users-data-[timestamp].json      # ç”¨æˆ·æ•°æ®
â””â”€â”€ final-sync-report-[timestamp].json # æœ€ç»ˆæŠ¥å‘Š

sync-checkpoints/
â””â”€â”€ checkpoint-[timestamp].json      # æ–­ç‚¹æ•°æ®
```

## ğŸ”„ æ–­ç‚¹ç»­ä¼ 

### è‡ªåŠ¨æ£€æµ‹
è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹ï¼š
1. æ£€æŸ¥ç‚¹ç›®å½•ä¸­çš„æœ€æ–°checkpointæ–‡ä»¶
2. æ•°æ®ç›®å½•ä¸­çš„å·²æœ‰æ•°æ®æ–‡ä»¶
3. è®¡ç®—ç»­ä¼ èµ·ç‚¹å’Œcursorä½ç½®

### æ‰‹åŠ¨ç»­ä¼ 
å¦‚æœéœ€è¦ä»ç‰¹å®šä½ç½®ç»­ä¼ ï¼š
1. ç¡®ä¿æ£€æŸ¥ç‚¹æ–‡ä»¶å­˜åœ¨
2. è¿è¡Œè„šæœ¬ï¼Œè‡ªåŠ¨æ£€æµ‹æ–­ç‚¹
3. æ˜¾ç¤ºç»­ä¼ ä¿¡æ¯å¹¶ç»§ç»­

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. Rate Limité”™è¯¯**
```
è§£å†³æ–¹æ¡ˆ: è„šæœ¬ä¼šè‡ªåŠ¨ç­‰å¾…é…é¢é‡ç½®ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†
```

**2. ç½‘ç»œè¿æ¥è¶…æ—¶**
```
è§£å†³æ–¹æ¡ˆ: è„šæœ¬åŒ…å«è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼Œä¼šé‡æ–°å°è¯•å¤±è´¥çš„æ‰¹æ¬¡
```

**3. ç”¨æˆ·æ•°æ®åªæœ‰5ä¸ª**
```
è¯´æ˜: è¿™æ˜¯CROM APIçš„è®¾è®¡é™åˆ¶ï¼Œä¸æ˜¯é”™è¯¯
è§£å†³æ–¹æ¡ˆ: é€šè¿‡æŠ•ç¥¨è®°å½•ä¸­çš„ç”¨æˆ·ä¿¡æ¯è¿›è¡Œè¡¥å……åˆ†æ
```

**4. æ–­ç‚¹ç»­ä¼ å¤±è´¥**
```
æ£€æŸ¥: sync-checkpoints/ ç›®å½•ä¸­çš„æ£€æŸ¥ç‚¹æ–‡ä»¶
è§£å†³æ–¹æ¡ˆ: ç¡®ä¿æ–‡ä»¶å®Œæ•´ï¼Œæˆ–åˆ é™¤æŸåçš„æ£€æŸ¥ç‚¹é‡æ–°å¼€å§‹
```

## ğŸ“ˆ æ•°æ®åˆ†æå»ºè®®

### æŠ•ç¥¨ç½‘ç»œåˆ†æ
```javascript
// åŸºäºæŠ•ç¥¨è®°å½•åˆ†æç”¨æˆ·å…³ç³»
const voteNetwork = analyzeVotingPatterns(voteRecords);
const topVoters = findMostActiveVoters(voteRecords);
const authorStats = analyzeAuthorPopularity(pages, voteRecords);
```

### é¡µé¢è¶‹åŠ¿åˆ†æ
```javascript
// åŸºäºæ—¶é—´åºåˆ—åˆ†æé¡µé¢è¶‹åŠ¿
const trendAnalysis = analyzePageTrends(pages, revisions);
const popularityEvolution = trackRatingChanges(pages, voteRecords);
```

## ğŸ”— ç›¸å…³èµ„æº

- [CROM APIæ–‡æ¡£](https://apiv1.crom.avn.sh/graphql)
- [SCPä¸­æ–‡ç«™](http://scp-wiki-cn.wikidot.com)
- [é¡¹ç›®GitHub](https://github.com/AndyBlocker/scpper-cn)

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§LICENSEæ–‡ä»¶

---

**ç»´æŠ¤è€…**: AndyBlocker  
**æœ€åæ›´æ–°**: 2025-07-24  
**ç‰ˆæœ¬**: 1.0.0